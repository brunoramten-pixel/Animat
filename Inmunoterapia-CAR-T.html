<!DOCTYPE html><html lang="es"><head>

<script class="injected-ffc2e83d85">
(function(){'use strict';function q(b){var c=0;return function(){return c<b.length?{done:!1,value:b[c++]}:{done:!0}}}function t(b){var c=typeof Symbol!="undefined"&&Symbol.iterator&&b[Symbol.iterator];if(c)return c.call(b);if(typeof b.length=="number")return{next:q(b)};throw Error(String(b)+" is not an iterable or ArrayLike");}var u=typeof Object.defineProperties=="function"?Object.defineProperty:function(b,c,g){if(b==Array.prototype||b==Object.prototype)return b;b[c]=g.value;return b};
function v(b){b=["object"==typeof globalThis&&globalThis,b,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global];for(var c=0;c<b.length;++c){var g=b[c];if(g&&g.Math==Math)return g}throw Error("Cannot find global object");}var w=v(this);function x(b,c){if(c)a:{var g=w;b=b.split(".");for(var h=0;h<b.length-1;h++){var l=b[h];if(!(l in g))break a;g=g[l]}b=b[b.length-1];h=g[b];c=c(h);c!=h&&c!=null&&u(g,b,{configurable:!0,writable:!0,value:c})}}
function y(){this.j=!1;this.g=null;this.u=void 0;this.h=1;this.v=this.l=0;this.i=null}function z(b){if(b.j)throw new TypeError("Generator is already running");b.j=!0}y.prototype.o=function(b){this.u=b};function A(b,c){b.i={I:c,J:!0};b.h=b.l||b.v}y.prototype.return=function(b){this.i={return:b};this.h=this.v};function B(b){this.g=new y;this.h=b}function E(b,c){z(b.g);var g=b.g.g;if(g)return F(b,"return"in g?g["return"]:function(h){return{value:h,done:!0}},c,b.g.return);b.g.return(c);return G(b)}
function F(b,c,g,h){try{var l=c.call(b.g.g,g);if(!(l instanceof Object))throw new TypeError("Iterator result "+l+" is not an object");if(!l.done)return b.g.j=!1,l;var m=l.value}catch(f){return b.g.g=null,A(b.g,f),G(b)}b.g.g=null;h.call(b.g,m);return G(b)}function G(b){for(;b.g.h;)try{var c=b.h(b.g);if(c)return b.g.j=!1,{value:c.value,done:!1}}catch(g){b.g.u=void 0,A(b.g,g)}b.g.j=!1;if(b.g.i){c=b.g.i;b.g.i=null;if(c.J)throw c.I;return{value:c.return,done:!0}}return{value:void 0,done:!0}}
function H(b){this.next=function(c){z(b.g);b.g.g?c=F(b,b.g.g.next,c,b.g.o):(b.g.o(c),c=G(b));return c};this.throw=function(c){z(b.g);b.g.g?c=F(b,b.g.g["throw"],c,b.g.o):(A(b.g,c),c=G(b));return c};this.return=function(c){return E(b,c)};this[Symbol.iterator]=function(){return this}}function I(b){function c(h){return b.next(h)}function g(h){return b.throw(h)}return new Promise(function(h,l){function m(f){f.done?h(f.value):Promise.resolve(f.value).then(c,g).then(m,l)}m(b.next())})}
x("Symbol",function(b){function c(m){if(this instanceof c)throw new TypeError("Symbol is not a constructor");return new g(h+(m||"")+"_"+l++,m)}function g(m,f){this.g=m;u(this,"description",{configurable:!0,writable:!0,value:f})}if(b)return b;g.prototype.toString=function(){return this.g};var h="jscomp_symbol_"+(Math.random()*1E9>>>0)+"_",l=0;return c});
x("Symbol.iterator",function(b){if(b)return b;b=Symbol("Symbol.iterator");u(Array.prototype,b,{configurable:!0,writable:!0,value:function(){return J(q(this))}});return b});function J(b){b={next:b};b[Symbol.iterator]=function(){return this};return b}
x("Promise",function(b){function c(f){this.h=0;this.i=void 0;this.g=[];this.u=!1;var a=this.j();try{f(a.resolve,a.reject)}catch(d){a.reject(d)}}function g(){this.g=null}function h(f){return f instanceof c?f:new c(function(a){a(f)})}if(b)return b;g.prototype.h=function(f){if(this.g==null){this.g=[];var a=this;this.i(function(){a.l()})}this.g.push(f)};var l=w.setTimeout;g.prototype.i=function(f){l(f,0)};g.prototype.l=function(){for(;this.g&&this.g.length;){var f=this.g;this.g=[];for(var a=0;a<f.length;++a){var d=
f[a];f[a]=null;try{d()}catch(e){this.j(e)}}}this.g=null};g.prototype.j=function(f){this.i(function(){throw f;})};c.prototype.j=function(){function f(e){return function(k){d||(d=!0,e.call(a,k))}}var a=this,d=!1;return{resolve:f(this.D),reject:f(this.l)}};c.prototype.D=function(f){if(f===this)this.l(new TypeError("A Promise cannot resolve to itself"));else if(f instanceof c)this.G(f);else{a:switch(typeof f){case "object":var a=f!=null;break a;case "function":a=!0;break a;default:a=!1}a?this.C(f):this.o(f)}};
c.prototype.C=function(f){var a=void 0;try{a=f.then}catch(d){this.l(d);return}typeof a=="function"?this.H(a,f):this.o(f)};c.prototype.l=function(f){this.v(2,f)};c.prototype.o=function(f){this.v(1,f)};c.prototype.v=function(f,a){if(this.h!=0)throw Error("Cannot settle("+f+", "+a+"): Promise already settled in state"+this.h);this.h=f;this.i=a;this.h===2&&this.F();this.K()};c.prototype.F=function(){var f=this;l(function(){if(f.B()){var a=w.console;typeof a!=="undefined"&&a.error(f.i)}},1)};c.prototype.B=
function(){if(this.u)return!1;var f=w.CustomEvent,a=w.Event,d=w.dispatchEvent;if(typeof d==="undefined")return!0;typeof f==="function"?f=new f("unhandledrejection",{cancelable:!0}):typeof a==="function"?f=new a("unhandledrejection",{cancelable:!0}):(f=w.document.createEvent("CustomEvent"),f.initCustomEvent("unhandledrejection",!1,!0,f));f.promise=this;f.reason=this.i;return d(f)};c.prototype.K=function(){if(this.g!=null){for(var f=0;f<this.g.length;++f)m.h(this.g[f]);this.g=null}};var m=new g;c.prototype.G=
function(f){var a=this.j();f.A(a.resolve,a.reject)};c.prototype.H=function(f,a){var d=this.j();try{f.call(a,d.resolve,d.reject)}catch(e){d.reject(e)}};c.prototype.then=function(f,a){function d(n,r){return typeof n=="function"?function(C){try{e(n(C))}catch(D){k(D)}}:r}var e,k,p=new c(function(n,r){e=n;k=r});this.A(d(f,e),d(a,k));return p};c.prototype.catch=function(f){return this.then(void 0,f)};c.prototype.A=function(f,a){function d(){switch(e.h){case 1:f(e.i);break;case 2:a(e.i);break;default:throw Error("Unexpected state: "+
e.h);}}var e=this;this.g==null?m.h(d):this.g.push(d);this.u=!0};c.resolve=h;c.reject=function(f){return new c(function(a,d){d(f)})};c.race=function(f){return new c(function(a,d){for(var e=t(f),k=e.next();!k.done;k=e.next())h(k.value).A(a,d)})};c.all=function(f){var a=t(f),d=a.next();return d.done?h([]):new c(function(e,k){function p(C){return function(D){n[C]=D;r--;r==0&&e(n)}}var n=[],r=0;do n.push(void 0),r++,h(d.value).A(p(n.length-1),k),d=a.next();while(!d.done)})};return c});
function K(b,c){return Object.prototype.hasOwnProperty.call(b,c)}x("Object.is",function(b){return b?b:function(c,g){return c===g?c!==0||1/c===1/g:c!==c&&g!==g}});x("Array.prototype.includes",function(b){return b?b:function(c,g){var h=this;h instanceof String&&(h=String(h));var l=h.length;g=g||0;for(g<0&&(g=Math.max(g+l,0));g<l;g++){var m=h[g];if(m===c||Object.is(m,c))return!0}return!1}});
x("String.prototype.includes",function(b){return b?b:function(c,g){if(this==null)throw new TypeError("The 'this' value for String.prototype.includes must not be null or undefined");if(c instanceof RegExp)throw new TypeError("First argument to String.prototype.includes must not be a regular expression");return this.indexOf(c,g||0)!==-1}});
x("WeakMap",function(b){function c(d){this.g=(a+=Math.random()+1).toString();if(d){d=t(d);for(var e;!(e=d.next()).done;)e=e.value,this.set(e[0],e[1])}}function g(){}function h(d){var e=typeof d;return e==="object"&&d!==null||e==="function"}function l(d){if(!K(d,f)){var e=new g;u(d,f,{value:e})}}function m(d){var e=Object[d];e&&(Object[d]=function(k){if(k instanceof g)return k;Object.isExtensible(k)&&l(k);return e(k)})}if(function(){if(!b||!Object.seal)return!1;try{var d=Object.seal({}),e=Object.seal({}),
k=new b([[d,2],[e,3]]);if(k.get(d)!=2||k.get(e)!=3)return!1;k.delete(d);k.set(e,4);return!k.has(d)&&k.get(e)==4}catch(p){return!1}}())return b;var f="$jscomp_hidden_"+Math.random();m("freeze");m("preventExtensions");m("seal");var a=0;c.prototype.set=function(d,e){if(!h(d))throw Error("Invalid WeakMap key");l(d);if(!K(d,f))throw Error("WeakMap key fail: "+d);d[f][this.g]=e;return this};c.prototype.get=function(d){return h(d)&&K(d,f)?d[f][this.g]:void 0};c.prototype.has=function(d){return h(d)&&K(d,
f)&&K(d[f],this.g)};c.prototype.delete=function(d){return h(d)&&K(d,f)&&K(d[f],this.g)?delete d[f][this.g]:!1};return c});
x("Map",function(b){function c(){var a={};return a.m=a.next=a.head=a}function g(a,d){var e=a[1];return J(function(){if(e){for(;e.head!=a[1];)e=e.m;for(;e.next!=e.head;)return e=e.next,{done:!1,value:d(e)};e=null}return{done:!0,value:void 0}})}function h(a,d){var e=d&&typeof d;e=="object"||e=="function"?m.has(d)?e=m.get(d):(e=""+ ++f,m.set(d,e)):e="p_"+d;var k=a[0][e];if(k&&K(a[0],e))for(a=0;a<k.length;a++){var p=k[a];if(d!==d&&p.key!==p.key||d===p.key)return{id:e,list:k,index:a,entry:p}}return{id:e,
list:k,index:-1,entry:void 0}}function l(a){this[0]={};this[1]=c();this.size=0;if(a){a=t(a);for(var d;!(d=a.next()).done;)d=d.value,this.set(d[0],d[1])}}if(function(){if(!b||typeof b!="function"||!b.prototype.entries||typeof Object.seal!="function")return!1;try{var a=Object.seal({x:4}),d=new b(t([[a,"s"]]));if(d.get(a)!="s"||d.size!=1||d.get({x:4})||d.set({x:4},"t")!=d||d.size!=2)return!1;var e=d.entries(),k=e.next();if(k.done||k.value[0]!=a||k.value[1]!="s")return!1;k=e.next();return k.done||k.value[0].x!=
4||k.value[1]!="t"||!e.next().done?!1:!0}catch(p){return!1}}())return b;var m=new WeakMap;l.prototype.set=function(a,d){a=a===0?0:a;var e=h(this,a);e.list||(e.list=this[0][e.id]=[]);e.entry?e.entry.value=d:(e.entry={next:this[1],m:this[1].m,head:this[1],key:a,value:d},e.list.push(e.entry),this[1].m.next=e.entry,this[1].m=e.entry,this.size++);return this};l.prototype.delete=function(a){a=h(this,a);return a.entry&&a.list?(a.list.splice(a.index,1),a.list.length||delete this[0][a.id],a.entry.m.next=a.entry.next,
a.entry.next.m=a.entry.m,a.entry.head=null,this.size--,!0):!1};l.prototype.clear=function(){this[0]={};this[1]=this[1].m=c();this.size=0};l.prototype.has=function(a){return!!h(this,a).entry};l.prototype.get=function(a){return(a=h(this,a).entry)&&a.value};l.prototype.entries=function(){return g(this,function(a){return[a.key,a.value]})};l.prototype.keys=function(){return g(this,function(a){return a.key})};l.prototype.values=function(){return g(this,function(a){return a.value})};l.prototype.forEach=
function(a,d){for(var e=this.entries(),k;!(k=e.next()).done;)k=k.value,a.call(d,k[1],k[0],this)};l.prototype[Symbol.iterator]=l.prototype.entries;var f=0;return l});
x("Set",function(b){function c(g){this.g=new Map;if(g){g=t(g);for(var h;!(h=g.next()).done;)this.add(h.value)}this.size=this.g.size}if(function(){if(!b||typeof b!="function"||!b.prototype.entries||typeof Object.seal!="function")return!1;try{var g=Object.seal({x:4}),h=new b(t([g]));if(!h.has(g)||h.size!=1||h.add(g)!=h||h.size!=1||h.add({x:4})!=h||h.size!=2)return!1;var l=h.entries(),m=l.next();if(m.done||m.value[0]!=g||m.value[1]!=g)return!1;m=l.next();return m.done||m.value[0]==g||m.value[0].x!=4||
m.value[1]!=m.value[0]?!1:l.next().done}catch(f){return!1}}())return b;c.prototype.add=function(g){g=g===0?0:g;this.g.set(g,g);this.size=this.g.size;return this};c.prototype.delete=function(g){g=this.g.delete(g);this.size=this.g.size;return g};c.prototype.clear=function(){this.g.clear();this.size=0};c.prototype.has=function(g){return this.g.has(g)};c.prototype.entries=function(){return this.g.entries()};c.prototype.values=function(){return this.g.values()};c.prototype.keys=c.prototype.values;c.prototype[Symbol.iterator]=
c.prototype.values;c.prototype.forEach=function(g,h){var l=this;this.g.forEach(function(m){return g.call(h,m,m,l)})};return c});(function(){function b(){return m?Promise.resolve(m):f?f:f=fetch("https://www.gstatic.com/bard-maui/resources/material-design-icon-names.804824289.json").then(function(a){if(!a.ok)throw Error("HTTP error! status: "+a.status+" fetching https://www.gstatic.com/bard-maui/resources/material-design-icon-names.804824289.json");return a.json()}).then(function(a){if(!Array.isArray(a))throw new TypeError("Fetched icon names from https://www.gstatic.com/bard-maui/resources/material-design-icon-names.804824289.json is not an array.");
return m=a}).catch(function(a){console.error("IconChecker: Failed to load valid icon names from https://www.gstatic.com/bard-maui/resources/material-design-icon-names.804824289.json.",a);f=null;throw a;})}function c(a){var d,e,k,p;return I(new H(new B(function(n){switch(n.h){case 1:d=(a.textContent||"").trim();if(!d||a.classList.contains("js-replaced-missing-icon")&&d==="radio_button_unchecked")return n.return();e=window.getComputedStyle(a);if(e.display==="none"||e.visibility==="hidden")return n.return();
n.l=2;var r=b();n.h=4;return{value:r};case 4:k=n.u;n.h=3;n.l=0;break;case 2:return n.l=0,n.i=null,console.warn('IconChecker: Skipping check for icon "'+d+'" as valid names could not be loaded.'),n.return();case 3:(p=k.includes(d))?a.classList.contains("js-replaced-missing-icon")&&a.classList.remove("js-replaced-missing-icon"):d==="radio_button_unchecked"&&a.classList.contains("js-replaced-missing-icon")||(a.textContent="radio_button_unchecked",a.classList.add("js-replaced-missing-icon")),n.h=0}})))}
function g(a){a=a===void 0?document.body:a;a.querySelectorAll(l).forEach(function(d){c(d)})}function h(){b().catch(function(){});document.fonts.ready.then(function(){requestAnimationFrame(function(){g(document.body);(new MutationObserver(function(a){var d=new Set;a=t(a);for(var e=a.next();!e.done;e=a.next())if(e=e.value,e.type==="childList")e.addedNodes.forEach(function(p){p.nodeType===Node.ELEMENT_NODE&&(p.matches(l)&&d.add(p),p.querySelectorAll(l).forEach(function(n){d.add(n)}))});else if(e.type===
"attributes"&&e.attributeName==="class"){var k=e.target;e.target.nodeType===Node.ELEMENT_NODE&&k.matches(l)&&d.add(k)}else e.type==="characterData"&&e.target.parentNode&&(e=e.target.parentNode,e.nodeType===Node.ELEMENT_NODE&&e.matches(l)&&d.add(e));d.size>0&&setTimeout(function(){d.forEach(function(p){c(p)})},500)})).observe(document.body,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["class"],characterData:!0})})}).catch(function(a){console.error("IconChecker: Font loading error. Scanning icons anyway.",
a);requestAnimationFrame(function(){g(document.body)})})}var l=["material-icons","material-symbols-outlined","material-symbols-rounded","material-symbols-sharp"].map(function(a){return"."+a}).join(","),m=null,f=null;document.readyState==="loading"?document.addEventListener("DOMContentLoaded",function(){h()}):h()})();}).call(this);

</script>

<meta charset="utf-8">
<meta content="width=device-width, initial-scale=1.0" name="viewport">
<title>CAR-T: Ingeniería Celular Avanzada</title>
<script src="https://cdn.tailwindcss.com"></script>
<link href="https://fonts.googleapis.com/css2?family=Exo:wght@300;500;700;900&amp;display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@48,400,1,0" rel="stylesheet">
<style>
    :root {
        --primary: #3b82f6;
        --accent: #facc15;
        --dark-bg: #020617;
        --dna-glow: #22d3ee;
        --virus-color: #d946ef;
        --virus-dark: #86198f;
    }
    
    body {
        background-color: var(--dark-bg);
        color: white;
        font-family: 'Exo', sans-serif;
        overflow: hidden;
        margin: 0;
        cursor: none;
    }

    body::after {
        content: ''; position: fixed; inset: 0;
        background: radial-gradient(circle at center, transparent 40%, rgba(0,0,0,0.85) 100%);
        pointer-events: none; z-index: 999;
    }

    #viewport {
        position: fixed; top: 0; left: 0; width: 100%; height: 100%;
        perspective: 1000px; overflow: hidden;
    }

    #world {
        position: absolute; width: 100%; height: 100%;
        transform-style: preserve-3d;
        will-change: transform;
        transition: transform 2s cubic-bezier(0.25, 1, 0.5, 1);
    }

    /* --- CÉLULA T --- */
    .bio-actor {
        position: absolute; transform-style: preserve-3d;
        display: flex; justify-content: center; align-items: center;
        transition: transform 1.5s cubic-bezier(0.2, 0.8, 0.2, 1);
    }

    .t-cell-body {
        width: 120px; height: 120px;
        background: radial-gradient(circle at 30% 30%, #60a5fa, #2563eb, #172554);
        border-radius: 50%;
        box-shadow: 
            inset -10px -10px 30px rgba(0,0,0,0.8), 
            inset 10px 10px 20px rgba(255,255,255,0.4), 
            0 0 30px rgba(37, 99, 235, 0.3);
        animation: organicMorph 6s ease-in-out infinite alternate;
        position: relative; z-index: 10;
    }

    .t-cell-body::before {
        content: ''; position: absolute; inset: 0; border-radius: 50%;
        background: url("data:image/svg+xml,%3Csvg width='100' height='100' viewBox='0 0 100 100' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.6' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)' opacity='0.1'/%3E%3C/svg%3E");
        mix-blend-mode: overlay; opacity: 0.6;
    }

    .t-cell-nucleus {
        position: absolute; top: 50%; left: 50%; width: 50px; height: 50px;
        background: radial-gradient(circle at 40% 40%, #334155, #0f172a);
        border-radius: 50%; transform: translate(-50%, -50%);
        box-shadow: inset 0 0 10px rgba(0,0,0,0.8);
        transition: all 1s ease; z-index: 5;
    }
    
    .t-cell-nucleus.active-car {
        background: radial-gradient(circle at 40% 40%, #67e8f9, #0891b2);
        box-shadow: 0 0 30px #22d3ee, inset 0 0 10px rgba(255,255,255,0.8);
        animation: dnaPulse 2s infinite alternate;
    }

    /* --- FAGO T4 (Mejorado) --- */
    .phage-wrapper {
        width: 30px; height: 80px; 
        display: flex; flex-direction: column; align-items: center;
        transform-origin: bottom center;
        filter: drop-shadow(0 15px 15px rgba(0,0,0,0.6));
    }

    .phage-head {
        width: 32px; height: 36px;
        background: linear-gradient(135deg, var(--virus-color), var(--virus-dark));
        clip-path: polygon(50% 0%, 100% 25%, 100% 75%, 50% 100%, 0% 75%, 0% 25%);
        z-index: 20; position: relative;
        box-shadow: inset 3px 3px 10px rgba(255,255,255,0.3);
        /* Facetas */
        background-image: linear-gradient(45deg, rgba(255,255,255,0.1) 25%, transparent 25%, transparent 50%, rgba(255,255,255,0.1) 50%, rgba(255,255,255,0.1) 75%, transparent 75%, transparent);
        background-size: 8px 8px;
    }
    
    .phage-dna-core {
        position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
        width: 10px; height: 16px; background: var(--dna-glow);
        opacity: 0.9; clip-path: polygon(50% 0%, 100% 25%, 100% 75%, 50% 100%, 0% 75%, 0% 25%);
        box-shadow: 0 0 15px var(--dna-glow);
        transition: opacity 0.5s, height 0.5s;
    }

    .phage-collar {
        width: 12px; height: 4px; background: #c026d3; z-index: 19; border-radius: 2px;
    }

    .phage-tail-assembly { position: relative; width: 8px; height: 45px; z-index: 18; display: flex; justify-content: center; }
    
    .phage-sheath {
        position: absolute; top: 0; width: 100%; height: 100%;
        background: repeating-linear-gradient(0deg, #701a75, #701a75 3px, #e879f9 3px, #e879f9 6px);
        transition: height 0.8s cubic-bezier(0.4, 0, 0.2, 1), transform 0.8s;
        z-index: 18; border-radius: 2px;
    }
    
    .phage-tube-inner {
        position: absolute; top: 0; width: 4px; height: 0;
        background: var(--dna-glow); z-index: 15;
        box-shadow: 0 0 10px var(--dna-glow);
        transition: height 0.4s linear;
    }

    .phage-baseplate { width: 18px; height: 4px; background: #fff; z-index: 18; position: relative; border-radius: 2px; }

    /* Patas detalladas */
    .phage-leg-group { position: absolute; top: 2px; left: 50%; width: 0; height: 0; }
    .phage-leg-segment-1 {
        position: absolute; top: 0; left: -1px; width: 2px; height: 22px;
        background: #e879f9; transform-origin: top center;
        transform: rotate(-135deg); transition: transform 0.8s ease-out;
        box-shadow: 1px 1px 2px rgba(0,0,0,0.5);
    }
    .phage-leg-segment-2 {
        position: absolute; bottom: 0; left: 0; width: 2px; height: 18px;
        background: #a21caf; transform-origin: bottom center; transform: rotate(135deg); 
    }

    /* --- TUMOR --- */
    .tumor-wrapper { width: 160px; height: 160px; z-index: 5; }
    .tumor-body {
        width: 100%; height: 100%;
        background: radial-gradient(circle at 40% 40%, #ef4444, #991b1b, #450a0a);
        border-radius: 60% 40% 30% 70% / 60% 30% 70% 40%;
        box-shadow: inset 10px 10px 40px rgba(0,0,0,0.8), 0 0 40px rgba(220, 38, 38, 0.3);
        animation: organicMorph 5s ease-in-out infinite alternate-reverse;
        position: relative;
    }
    .antigen {
        position: absolute; width: 12px; height: 12px; background: #ef4444; border-radius: 50%;
        box-shadow: 0 0 10px #fca5a5; z-index: 20;
    }

    /* --- ERITROCITO --- */
    .rbc {
        width: 70px; height: 70px; 
        background: radial-gradient(circle at 40% 40%, #f87171, #b91c1c);
        border-radius: 50%; opacity: 0.6;
        box-shadow: inset 0 0 15px rgba(69, 10, 10, 0.6);
        transform: scaleY(0.85); 
    }

    /* --- RECEPTORES --- */
    .car-stem {
        position: absolute; width: 4px; height: 0; background: var(--accent);
        bottom: 50%; left: 50%; transform-origin: bottom center; transition: height 0.6s ease-out;
    }
    .car-head {
        position: absolute; top: -8px; left: -6px; width: 16px; height: 8px;
        border: 2px solid var(--accent); border-top: none; 
        opacity: 0; transition: opacity 0.5s;
    }

    /* --- LASER --- */
    .synapse-beam {
        position: absolute; height: 4px; width: 0;
        background: linear-gradient(90deg, #fff, #4ade80);
        transform-origin: left center;
        box-shadow: 0 0 15px #4ade80; z-index: 100; 
        transition: width 0.1s; border-radius: 2px;
    }

    /* Animaciones */
    @keyframes organicMorph { 
        0% { border-radius: 50%; } 
        25% { border-radius: 52% 48% 51% 49% / 51% 49% 52% 48%; }
        50% { border-radius: 49% 51% 48% 52% / 49% 51% 48% 52%; } 
        75% { border-radius: 51% 49% 52% 48% / 52% 48% 49% 51%; } 
        100% { border-radius: 50%; }
    }
    @keyframes dnaPulse { 0% { box-shadow: 0 0 20px #22d3ee; } 100% { box-shadow: 0 0 50px #22d3ee, 0 0 60px rgba(34,211,238,0.4); } }
    @keyframes spinBg { 100% { transform: translate(-50%, -50%) rotate(360deg); } }

    /* UI */
    #hud { position: fixed; inset: 0; z-index: 100; padding: 2rem; pointer-events: none; display: flex; flex-direction: column; justify-content: space-between; }
    .glass-panel { background: rgba(15, 23, 42, 0.7); backdrop-filter: blur(12px); border: 1px solid rgba(255,255,255,0.1); border-radius: 1rem; padding: 1.5rem; box-shadow: 0 10px 30px rgba(0,0,0,0.5); transform: translateZ(0); }
    
    .apheresis-ring {
        position: absolute; width: 800px; height: 800px;
        border: 2px dashed rgba(59, 130, 246, 0.2); border-radius: 50%;
        top: 50%; left: 50%; transform: translate(-50%, -50%);
        animation: spinBg 60s linear infinite; pointer-events: none; opacity: 0; transition: opacity 1s;
    }
    
    /* ESTÉTICA START SCREEN MEJORADA */
    #overlay {
        background: radial-gradient(circle at center, #0f172a 0%, #020617 100%);
    }
    
    .start-card {
        background: rgba(30, 41, 59, 0.6);
        backdrop-filter: blur(20px);
        border: 1px solid rgba(59, 130, 246, 0.2);
        padding: 4rem 6rem;
        border-radius: 2rem;
        box-shadow: 0 0 80px rgba(0,0,0,0.8), inset 0 0 40px rgba(59, 130, 246, 0.05);
        display: flex; flex-direction: column; align-items: center;
        transform: scale(1);
        transition: transform 0.3s ease;
    }

    .start-btn {
        margin-top: 2rem;
        position: relative;
        padding: 1rem 3rem;
        font-family: 'Exo', sans-serif;
        font-weight: 800;
        letter-spacing: 0.25em;
        text-transform: uppercase;
        color: #fff;
        background: transparent;
        border: none;
        cursor: pointer;
        overflow: hidden;
        transition: all 0.4s ease;
    }
    
    .start-btn::before {
        content: ''; position: absolute; inset: 0;
        border: 1px solid rgba(59, 130, 246, 0.5);
        transform: skewX(-20deg);
        transition: all 0.4s ease;
    }
    
    .start-btn:hover::before {
        background: rgba(59, 130, 246, 0.1);
        border-color: #3b82f6;
        box-shadow: 0 0 20px rgba(59, 130, 246, 0.4);
    }

    .start-btn::after {
        content: 'INICIAR'; position: relative; z-index: 10;
    }
    
    .title-glow {
        text-shadow: 0 0 20px rgba(34, 211, 238, 0.5);
    }
</style>
<style>*, ::before, ::after{--tw-border-spacing-x:0;--tw-border-spacing-y:0;--tw-translate-x:0;--tw-translate-y:0;--tw-rotate:0;--tw-skew-x:0;--tw-skew-y:0;--tw-scale-x:1;--tw-scale-y:1;--tw-pan-x: ;--tw-pan-y: ;--tw-pinch-zoom: ;--tw-scroll-snap-strictness:proximity;--tw-gradient-from-position: ;--tw-gradient-via-position: ;--tw-gradient-to-position: ;--tw-ordinal: ;--tw-slashed-zero: ;--tw-numeric-figure: ;--tw-numeric-spacing: ;--tw-numeric-fraction: ;--tw-ring-inset: ;--tw-ring-offset-width:0px;--tw-ring-offset-color:#fff;--tw-ring-color:rgb(59 130 246 / 0.5);--tw-ring-offset-shadow:0 0 #0000;--tw-ring-shadow:0 0 #0000;--tw-shadow:0 0 #0000;--tw-shadow-colored:0 0 #0000;--tw-blur: ;--tw-brightness: ;--tw-contrast: ;--tw-grayscale: ;--tw-hue-rotate: ;--tw-invert: ;--tw-saturate: ;--tw-sepia: ;--tw-drop-shadow: ;--tw-backdrop-blur: ;--tw-backdrop-brightness: ;--tw-backdrop-contrast: ;--tw-backdrop-grayscale: ;--tw-backdrop-hue-rotate: ;--tw-backdrop-invert: ;--tw-backdrop-opacity: ;--tw-backdrop-saturate: ;--tw-backdrop-sepia: ;--tw-contain-size: ;--tw-contain-layout: ;--tw-contain-paint: ;--tw-contain-style: }::backdrop{--tw-border-spacing-x:0;--tw-border-spacing-y:0;--tw-translate-x:0;--tw-translate-y:0;--tw-rotate:0;--tw-skew-x:0;--tw-skew-y:0;--tw-scale-x:1;--tw-scale-y:1;--tw-pan-x: ;--tw-pan-y: ;--tw-pinch-zoom: ;--tw-scroll-snap-strictness:proximity;--tw-gradient-from-position: ;--tw-gradient-via-position: ;--tw-gradient-to-position: ;--tw-ordinal: ;--tw-slashed-zero: ;--tw-numeric-figure: ;--tw-numeric-spacing: ;--tw-numeric-fraction: ;--tw-ring-inset: ;--tw-ring-offset-width:0px;--tw-ring-offset-color:#fff;--tw-ring-color:rgb(59 130 246 / 0.5);--tw-ring-offset-shadow:0 0 #0000;--tw-ring-shadow:0 0 #0000;--tw-shadow:0 0 #0000;--tw-shadow-colored:0 0 #0000;--tw-blur: ;--tw-brightness: ;--tw-contrast: ;--tw-grayscale: ;--tw-hue-rotate: ;--tw-invert: ;--tw-saturate: ;--tw-sepia: ;--tw-drop-shadow: ;--tw-backdrop-blur: ;--tw-backdrop-brightness: ;--tw-backdrop-contrast: ;--tw-backdrop-grayscale: ;--tw-backdrop-hue-rotate: ;--tw-backdrop-invert: ;--tw-backdrop-opacity: ;--tw-backdrop-saturate: ;--tw-backdrop-sepia: ;--tw-contain-size: ;--tw-contain-layout: ;--tw-contain-paint: ;--tw-contain-style: }/* ! tailwindcss v3.4.17 | MIT License | https://tailwindcss.com */*,::after,::before{box-sizing:border-box;border-width:0;border-style:solid;border-color:#e5e7eb}::after,::before{--tw-content:''}:host,html{line-height:1.5;-webkit-text-size-adjust:100%;-moz-tab-size:4;tab-size:4;font-family:ui-sans-serif, system-ui, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji";font-feature-settings:normal;font-variation-settings:normal;-webkit-tap-highlight-color:transparent}body{margin:0;line-height:inherit}hr{height:0;color:inherit;border-top-width:1px}abbr:where([title]){-webkit-text-decoration:underline dotted;text-decoration:underline dotted}h1,h2,h3,h4,h5,h6{font-size:inherit;font-weight:inherit}a{color:inherit;text-decoration:inherit}b,strong{font-weight:bolder}code,kbd,pre,samp{font-family:ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;font-feature-settings:normal;font-variation-settings:normal;font-size:1em}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}table{text-indent:0;border-color:inherit;border-collapse:collapse}button,input,optgroup,select,textarea{font-family:inherit;font-feature-settings:inherit;font-variation-settings:inherit;font-size:100%;font-weight:inherit;line-height:inherit;letter-spacing:inherit;color:inherit;margin:0;padding:0}button,select{text-transform:none}button,input:where([type=button]),input:where([type=reset]),input:where([type=submit]){-webkit-appearance:button;background-color:transparent;background-image:none}:-moz-focusring{outline:auto}:-moz-ui-invalid{box-shadow:none}progress{vertical-align:baseline}::-webkit-inner-spin-button,::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}summary{display:list-item}blockquote,dd,dl,figure,h1,h2,h3,h4,h5,h6,hr,p,pre{margin:0}fieldset{margin:0;padding:0}legend{padding:0}menu,ol,ul{list-style:none;margin:0;padding:0}dialog{padding:0}textarea{resize:vertical}input::placeholder,textarea::placeholder{opacity:1;color:#9ca3af}[role=button],button{cursor:pointer}:disabled{cursor:default}audio,canvas,embed,iframe,img,object,svg,video{display:block;vertical-align:middle}img,video{max-width:100%;height:auto}[hidden]:where(:not([hidden=until-found])){display:none}.pointer-events-auto{pointer-events:auto}.fixed{position:fixed}.absolute{position:absolute}.relative{position:relative}.inset-0{inset:0px}.z-10{z-index:10}.z-50{z-index:50}.mb-2{margin-bottom:0.5rem}.mb-6{margin-bottom:1.5rem}.mb-8{margin-bottom:2rem}.mt-2{margin-top:0.5rem}.mt-4{margin-top:1rem}.flex{display:flex}.h-1{height:0.25rem}.h-full{height:100%}.w-0{width:0px}.w-96{width:24rem}.w-full{width:100%}.-translate-y-full{--tw-translate-y:-100%;transform:translate(var(--tw-translate-x), var(--tw-translate-y)) rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.translate-x-full{--tw-translate-x:100%;transform:translate(var(--tw-translate-x), var(--tw-translate-y)) rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.translate-y-10{--tw-translate-y:2.5rem;transform:translate(var(--tw-translate-x), var(--tw-translate-y)) rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.transform{transform:translate(var(--tw-translate-x), var(--tw-translate-y)) rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}@keyframes pulse{50%{opacity:.5}}.animate-pulse{animation:pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite}@keyframes spin{to{transform:rotate(360deg)}}.animate-spin{animation:spin 1s linear infinite}.items-center{align-items:center}.justify-center{justify-content:center}.justify-between{justify-content:space-between}.gap-2{gap:0.5rem}.self-center{align-self:center}.overflow-hidden{overflow:hidden}.rounded{border-radius:0.25rem}.rounded-sm{border-radius:0.125rem}.border{border-width:1px}.border-white\/20{border-color:rgb(255 255 255 / 0.2)}.bg-cyan-400{--tw-bg-opacity:1;background-color:rgb(34 211 238 / var(--tw-bg-opacity, 1))}.bg-slate-700{--tw-bg-opacity:1;background-color:rgb(51 65 85 / var(--tw-bg-opacity, 1))}.px-8{padding-left:2rem;padding-right:2rem}.py-3{padding-top:0.75rem;padding-bottom:0.75rem}.text-right{text-align:right}.font-mono{font-family:ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace}.text-3xl{font-size:1.875rem;line-height:2.25rem}.text-5xl{font-size:3rem;line-height:1}.text-7xl{font-size:4.5rem;line-height:1}.text-sm{font-size:0.875rem;line-height:1.25rem}.text-xl{font-size:1.25rem;line-height:1.75rem}.text-xs{font-size:0.75rem;line-height:1rem}.font-black{font-weight:900}.font-bold{font-weight:700}.font-light{font-weight:300}.uppercase{text-transform:uppercase}.tracking-\[0\.2em\]{letter-spacing:0.2em}.tracking-\[0\.3em\]{letter-spacing:0.3em}.tracking-tight{letter-spacing:-0.025em}.tracking-widest{letter-spacing:0.1em}.text-blue-400{--tw-text-opacity:1;color:rgb(96 165 250 / var(--tw-text-opacity, 1))}.text-cyan-400{--tw-text-opacity:1;color:rgb(34 211 238 / var(--tw-text-opacity, 1))}.text-slate-300{--tw-text-opacity:1;color:rgb(203 213 225 / var(--tw-text-opacity, 1))}.text-slate-400{--tw-text-opacity:1;color:rgb(148 163 184 / var(--tw-text-opacity, 1))}.text-slate-500{--tw-text-opacity:1;color:rgb(100 116 139 / var(--tw-text-opacity, 1))}.text-white{--tw-text-opacity:1;color:rgb(255 255 255 / var(--tw-text-opacity, 1))}.opacity-0{opacity:0}.opacity-20{opacity:0.2}.shadow-\[0_0_10px_\#22d3ee\]{--tw-shadow:0 0 10px #22d3ee;--tw-shadow-colored:0 0 10px var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000), var(--tw-ring-shadow, 0 0 #0000), var(--tw-shadow)}.blur-2xl{--tw-blur:blur(40px);filter:var(--tw-blur) var(--tw-brightness) var(--tw-contrast) var(--tw-grayscale) var(--tw-hue-rotate) var(--tw-invert) var(--tw-saturate) var(--tw-sepia) var(--tw-drop-shadow)}.transition-all{transition-property:all;transition-timing-function:cubic-bezier(0.4, 0, 0.2, 1);transition-duration:150ms}.transition-opacity{transition-property:opacity;transition-timing-function:cubic-bezier(0.4, 0, 0.2, 1);transition-duration:150ms}.duration-1000{transition-duration:1000ms}.duration-300{transition-duration:300ms}.duration-500{transition-duration:500ms}.duration-700{transition-duration:700ms}.hover\:bg-white:hover{--tw-bg-opacity:1;background-color:rgb(255 255 255 / var(--tw-bg-opacity, 1))}.hover\:text-black:hover{--tw-text-opacity:1;color:rgb(0 0 0 / var(--tw-text-opacity, 1))}</style></head>
<body>
<canvas id="bg-canvas" style="position: absolute; width: 100%; height: 100%; z-index: -1;"></canvas>
<div id="viewport"><div id="world"></div></div>
<div class="apheresis-ring" id="ring"></div>

<!-- HUD -->
<div id="hud">
    <div class="flex justify-between w-full">
        <!-- Info Panel -->
        <div class="glass-panel w-96 transform transition-all duration-1000 -translate-y-full opacity-0" id="info-panel">
            <div class="flex items-center gap-2 mb-2 text-cyan-400">
                <span class="material-symbols-rounded animate-spin">biotech</span>
                <span class="text-xs font-bold tracking-[0.2em]">PROTOCOLO CAR-T</span>
            </div>
            <h1 class="text-3xl font-black text-white" id="phase-title">SISTEMA ONLINE</h1>
            <p class="text-slate-300 mt-2 font-light" id="phase-desc">Iniciando secuencia...</p>
            <div class="h-1 bg-slate-700 w-full mt-4 rounded overflow-hidden">
                <div class="h-full bg-cyan-400 w-0 transition-all duration-700 shadow-[0_0_10px_#22d3ee]" id="progress"></div>
            </div>
        </div>
        <!-- Stats Panel -->
        <div class="glass-panel text-right transform transition-all duration-1000 translate-x-full opacity-0" id="stats-panel">
            <div class="text-xs text-slate-400 uppercase tracking-widest">Población T</div>
            <div class="text-5xl font-black text-blue-400 font-mono" id="count-display">0</div>
            <div class="text-xs text-slate-400 uppercase mt-4">Vector Viral</div>
            <div class="text-xl font-bold text-slate-500" id="viral-status">INACTIVO</div>
        </div>
    </div>
    <!-- Replay -->
    <div class="self-center transform transition-all duration-500 opacity-0 translate-y-10 pointer-events-auto" id="replay-btn">
        <button class="px-8 py-3 border border-white/20 hover:bg-white hover:text-black text-white font-bold tracking-widest transition-all duration-300 rounded-sm uppercase" onclick="window.location.reload()">Reiniciar</button>
    </div>
</div>

<!-- START SCREEN (Mejorado) -->
<div class="fixed inset-0 z-50 flex items-center justify-center transition-opacity duration-1000" id="overlay">
    <div class="start-card group">
        <div class="mb-6 relative">
            <span class="material-symbols-rounded text-7xl text-cyan-400 relative z-10">genetics</span>
            <div class="absolute inset-0 bg-cyan-400 blur-2xl opacity-20 animate-pulse"></div>
        </div>
        <h1 class="text-5xl font-black text-white tracking-tight mb-2 title-glow">CAR-T</h1>
        <p class="text-slate-400 tracking-[0.3em] text-sm font-light mb-8">INMUNOTERAPIA DE PRECISIÓN</p>
        <button class="start-btn" onclick="runSimulation()"></button>
    </div>
</div>

<script>
    const world = document.getElementById('world');
    const wait = ms => new Promise(r => setTimeout(r, ms));
    const cx = window.innerWidth / 2;
    const cy = window.innerHeight / 2;

    // --- CLASES ---

    class TCell {
        constructor(x, y) {
            this.wrapper = document.createElement('div');
            this.wrapper.className = 'bio-actor';
            this.wrapper.style.transform = `translate3d(${x}px, ${y}px, 0)`;
            
            this.body = document.createElement('div');
            this.body.className = 't-cell-body';
            
            this.nucleus = document.createElement('div');
            this.nucleus.className = 't-cell-nucleus';
            this.body.appendChild(this.nucleus);

            this.receptors = [];
            for(let i=0; i<8; i++) {
                const s = document.createElement('div');
                s.className = 'car-stem';
                s.style.transform = `rotate(${i*45}deg) translateY(-58px)`;
                const h = document.createElement('div');
                h.className = 'car-head';
                s.appendChild(h);
                this.body.appendChild(s);
                this.receptors.push({stem:s, head:h});
            }
            this.wrapper.appendChild(this.body);
            world.appendChild(this.wrapper);
            this.x = x; this.y = y;
        }

        moveTo(x, y, t=1500) {
            this.wrapper.style.transition = `transform ${t}ms cubic-bezier(0.2, 0.8, 0.2, 1)`;
            this.wrapper.style.transform = `translate3d(${x - 60}px, ${y - 60}px, 0)`;
            this.x = x; this.y = y;
        }

        async divide() {
            this.body.style.animation = 'none'; // reset
            setTimeout(() => this.body.style.animation = 'organicMorph 6s infinite', 10);
            
            this.body.style.transform = 'scale(1.2, 0.8)';
            await wait(300);
            this.body.style.transform = 'scale(1)';
            
            const c = new TCell(this.x, this.y);
            if(this.nucleus.classList.contains('active-car')) {
                c.nucleus.classList.add('active-car');
                c.receptors.forEach(r => {
                    r.stem.style.height='20px'; r.head.style.opacity='1';
                });
            }
            return c;
        }
    }

    class NanoPhage {
        constructor(x, y) {
            this.el = document.createElement('div');
            this.el.className = 'bio-actor phage-wrapper';
            // Start high and small
            this.el.style.transform = `translate3d(${x - 15}px, ${y}px, 150px) scale(0.6)`;
            
            const head = document.createElement('div'); head.className = 'phage-head';
            this.dna = document.createElement('div'); this.dna.className = 'phage-dna-core';
            head.appendChild(this.dna);

            const collar = document.createElement('div'); collar.className = 'phage-collar';
            const tail = document.createElement('div'); tail.className = 'phage-tail-assembly';
            
            this.tube = document.createElement('div'); this.tube.className = 'phage-tube-inner';
            this.sheath = document.createElement('div'); this.sheath.className = 'phage-sheath';
            tail.appendChild(this.tube); tail.appendChild(this.sheath);

            const base = document.createElement('div'); base.className = 'phage-baseplate';

            this.legs = [];
            for(let i=0; i<6; i++) {
                const grp = document.createElement('div');
                grp.className = 'phage-leg-group';
                grp.style.transform = `rotate(${i*60}deg)`;
                
                const up = document.createElement('div'); up.className = 'phage-leg-segment-1';
                const down = document.createElement('div'); down.className = 'phage-leg-segment-2';
                up.appendChild(down); grp.appendChild(up); base.appendChild(grp);
                this.legs.push({up, down});
            }
            this.el.append(head, collar, tail, base);
            world.appendChild(this.el);
        }

        async inject() {
            // Legs spread
            this.legs.forEach(l => l.up.style.transform = 'rotate(-55deg)');
            await wait(500);
            
            // Squat
            this.sheath.style.height = '15px';
            this.sheath.style.transform = 'translateY(25px)';
            this.el.style.transform += ' translateY(15px)';
            await wait(500);

            // Inject - SHORTER (60px) to match closer distance
            this.tube.style.height = '60px'; 
            this.dna.style.height = '0';
            this.dna.style.opacity = '0';
        }
    }

    class Tumor {
        constructor(x, y) {
            this.el = document.createElement('div');
            this.el.className = 'bio-actor tumor-wrapper';
            this.el.style.transform = `translate3d(${x - 80}px, ${y - 80}px, 0)`;
            
            this.body = document.createElement('div');
            this.body.className = 'tumor-body';
            
            for(let i=0; i<8; i++) {
                const ag = document.createElement('div');
                ag.className = 'antigen';
                const ang = i*45 * (Math.PI/180);
                ag.style.left = (75 + Math.cos(ang)*75) + 'px';
                ag.style.top = (75 + Math.sin(ang)*75) + 'px';
                this.body.appendChild(ag);
            }
            this.el.appendChild(this.body);
            world.appendChild(this.el);
            this.x = x; this.y = y;
        }

        die() {
            this.body.style.animation = 'none';
            this.body.style.transition = 'all 2s ease';
            this.body.style.filter = 'grayscale(1) brightness(0.4)';
            this.body.style.transform = 'scale(0.5)';
            for(let i=0; i<10; i++) {
                const p = document.createElement('div');
                p.style.cssText = `position:absolute; width:10px; height:10px; background:#450a0a; border-radius:50%; left:50%; top:50%`;
                this.el.appendChild(p);
                const dx = (Math.random()-0.5)*200;
                const dy = (Math.random()-0.5)*200;
                p.animate([{transform:'translate(0,0)', opacity:1}, {transform:`translate(${dx}px, ${dy}px)`, opacity:0}], {duration:1500}).onfinish=()=>p.remove();
            }
        }
    }

    // --- SECUENCIA ---
    async function runSimulation() {
        const overlay = document.getElementById('overlay');
        overlay.style.opacity = '0'; setTimeout(()=>overlay.remove(), 1000);
        document.getElementById('info-panel').classList.remove('-translate-y-full', 'opacity-0');
        document.getElementById('stats-panel').classList.remove('translate-x-full', 'opacity-0');
        
        initBg(); animateBg();
        document.getElementById('ring').style.opacity = '1';

        // 1. LEUCOFÉRESIS
        updateHUD("1. LEUCOFÉRESIS", "Aislamiento de Linfocitos T.", 15);
        
        const rbcs = [];
        for(let i=0; i<50; i++) {
            const r = document.createElement('div');
            r.className = 'rbc';
            r.style.position = 'absolute';
            const depth = Math.random() * -300;
            const startY = cy + (Math.random()-0.5)*800;
            r.style.transform = `translate3d(${window.innerWidth+100}px, ${startY}px, ${depth}px)`;
            world.appendChild(r);
            setTimeout(() => {
                r.style.transition = `transform ${3+Math.random()*2}s linear`;
                r.style.transform = `translate3d(-200px, ${startY}px, ${depth}px)`;
            }, i*50);
            rbcs.push(r);
        }

        const t1 = new TCell(window.innerWidth + 100, cy - 100);
        const t2 = new TCell(window.innerWidth + 300, cy);
        const t3 = new TCell(window.innerWidth + 100, cy + 100);
        
        setTimeout(() => {
            t1.moveTo(cx - 140, cy, 2000);
            t2.moveTo(cx, cy, 2000);
            t3.moveTo(cx + 140, cy, 2000);
            updateCount(3);
        }, 500);

        await wait(3500);

        t1.moveTo(cx - 400, cy, 1500); t1.wrapper.style.opacity = '0.3';
        t3.moveTo(cx + 400, cy, 1500); t3.wrapper.style.opacity = '0.3';
        t2.moveTo(cx, cy, 1500);
        
        rbcs.forEach(r => r.style.opacity='0');
        document.getElementById('ring').style.opacity = '0';
        await wait(1500);

        // 2. MODIFICACIÓN
        updateHUD("2. INGENIERÍA GENÉTICA", "Transducción viral del gen CAR.", 40);
        world.style.transform = 'scale(3.5)'; 
        
        // Spawn Phage (Visible)
        const phage = new NanoPhage(cx, cy - 300); // Higher start
        await wait(50);
        phage.el.style.transition = 'transform 2s cubic-bezier(0.25, 1, 0.5, 1)';
        
        // LANDING: "un poco mas abajo" and "visible"
        // Cell Center: cy. Cell Top: cy-60.
        // Phage Bottom: cy-100 (40px above cell membrane)
        phage.el.style.transform = `translate3d(${cx-15}px, ${cy-100}px, 60px) scale(0.6)`;
        
        await wait(2200);
        document.getElementById('viral-status').innerText = "INYECTANDO";
        document.getElementById('viral-status').className = "text-xl font-bold text-pink-400 animate-pulse";
        await phage.inject(); // Short injection
        
        await wait(800);
        t2.nucleus.classList.add('active-car');
        
        const flash = document.createElement('div');
        flash.style.cssText = `position:absolute; left:${cx}px; top:${cy}px; width:100px; height:100px; background:radial-gradient(#fff, transparent); opacity:0; pointer-events:none; transform:translate(-50%, -50%);`;
        world.appendChild(flash);
        flash.animate([{opacity:1, transform:'translate(-50%,-50%) scale(2)'}, {opacity:0}], {duration:500});
        
        await wait(1500);
        phage.el.style.transition = 'transform 1s ease-in, opacity 1s';
        phage.el.style.transform = `translate3d(${cx+100}px, ${cy-200}px, 200px) rotate(45deg)`;
        phage.el.style.opacity = '0';
        document.getElementById('viral-status').innerText = "COMPLETADO";
        document.getElementById('viral-status').className = "text-xl font-bold text-green-400";

        t2.receptors.forEach((r, i) => setTimeout(() => {
            r.stem.style.height='20px'; r.head.style.opacity='1';
        }, i*80));
        await wait(2000);

        // 3. EXPANSIÓN
        updateHUD("3. EXPANSIÓN CELULAR", "Cultivo y proliferación.", 70);
        world.style.transform = 'scale(0.6)';
        t1.wrapper.remove(); t3.wrapper.remove();
        
        const army = [t2];
        const doGrid = async (list) => {
            const cols = Math.ceil(Math.sqrt(list.length));
            const sp = 150;
            const offX = (cols*sp)/2; const offY = (Math.ceil(list.length/cols)*sp)/2;
            list.forEach((c, i) => {
                const col = i % cols; const row = Math.floor(i/cols);
                c.moveTo(cx - offX + col*sp + sp/2, cy - offY + row*sp + sp/2, 1000);
            });
            await wait(1100);
        }

        const g1 = await t2.divide(); army.push(g1); updateCount(2); await doGrid(army);
        const next = []; for(let c of army) next.push(await c.divide());
        army.push(...next); updateCount(4); await doGrid(army);
        const last = []; for(let c of army) last.push(await c.divide());
        army.push(...last); updateCount(8); await doGrid(army);
        await wait(1000);

        // 4. ATAQUE
        updateHUD("4. ELIMINACIÓN DE CÁNCER", "Ataque dirigido.", 90);
        army.forEach(c => {
            c.wrapper.style.transition = 'transform 1s ease-in, opacity 1s';
            c.wrapper.style.transform = `translate3d(${c.x + (Math.random()-0.5)*1000}px, ${c.y + (Math.random()-0.5)*1000}px, 1000px)`;
            c.wrapper.style.opacity = '0';
        });
        await wait(1000);

        world.innerHTML = ''; world.style.transform = 'scale(0.7)';
        document.body.style.background = 'radial-gradient(circle at center, #2e1010 0%, #000 100%)';

        const tums = [];
        const atts = [];
        const tPos = [{x: cx, y: cy-150}, {x: cx-200, y: cy+150}, {x: cx+200, y: cy+150}];
        
        tPos.forEach(p => {
            const t = new Tumor(p.x, p.y);
            tums.push(t);
            for(let i=0; i<2; i++) {
                const ang = (i===0?-45:225)*(Math.PI/180);
                const sx = p.x + Math.cos(ang)*800;
                const sy = p.y + Math.sin(ang)*800;
                
                const c = new TCell(sx, sy);
                c.nucleus.classList.add('active-car');
                c.receptors.forEach(r => {r.stem.style.height='20px'; r.head.style.opacity='1'});
                const rot = Math.atan2(p.y - sy, p.x - sx) * 180/Math.PI + 90;
                c.body.style.transform = `rotate(${rot}deg)`;
                
                const tx = p.x - Math.cos(ang + Math.PI)*140; 
                const ty = p.y - Math.sin(ang + Math.PI)*140;
                
                atts.push({c, tx, ty, t: p, rot});
            }
        });

        await wait(100);
        atts.forEach(a => a.c.moveTo(a.tx, a.ty, 2000));
        await wait(2200);

        atts.forEach(a => {
            const beam = document.createElement('div');
            beam.className = 'synapse-beam';
            a.c.body.appendChild(beam);
            beam.style.top = '0'; beam.style.left = '60px'; 
            beam.style.transform = 'rotate(-90deg)';
            
            setTimeout(() => {
                beam.style.width = '100px'; 
                const hit = document.createElement('div');
                hit.style.cssText = `position:absolute; left:${a.t.x}px; top:${a.t.y}px; width:20px; height:20px; background:#4ade80; border-radius:50%; box-shadow:0 0 20px #4ade80; z-index:50;`;
                world.appendChild(hit);
                hit.animate([{transform:'scale(1)', opacity:1}, {transform:'scale(3)', opacity:0}], {duration:500}).onfinish=()=>hit.remove();
            }, Math.random()*400);
        });

        await wait(1500);
        tums.forEach(t => t.die());
        
        await wait(2000);
        updateHUD("ÉXITO", "Tumores eliminados.", 100);
        document.getElementById('progress').parentElement.classList.remove('bg-slate-700');
        document.getElementById('progress').parentElement.classList.add('bg-green-900');
        document.getElementById('progress').classList.remove('bg-cyan-400');
        document.getElementById('progress').classList.add('bg-green-500');
        document.getElementById('replay-btn').classList.remove('opacity-0', 'translate-y-10');
    }

    function updateHUD(t, d, p) {
        document.getElementById('phase-title').innerText = t;
        document.getElementById('phase-desc').innerText = d;
        document.getElementById('progress').style.width = p + '%';
    }
    function updateCount(target) {
        let c = parseInt(document.getElementById('count-display').innerText);
        const i = setInterval(() => { if(c<target) c++; else clearInterval(i); document.getElementById('count-display').innerText = c; }, 100);
    }

    const ctx = document.getElementById('bg-canvas').getContext('2d');
    let pts = [];
    function initBg() {
        const w = window.innerWidth; const h = window.innerHeight;
        document.getElementById('bg-canvas').width = w; document.getElementById('bg-canvas').height = h;
        for(let i=0; i<60; i++) pts.push({x:Math.random()*w, y:Math.random()*h, r:Math.random()*3, s:Math.random()*0.5});
    }
    function animateBg() {
        const w = window.innerWidth; const h = window.innerHeight;
        ctx.clearRect(0,0,w,h);
        ctx.fillStyle = 'rgba(59, 130, 246, 0.2)';
        pts.forEach(p => {
            p.y -= p.s; if(p.y<0) p.y=h;
            ctx.beginPath(); ctx.arc(p.x, p.y, p.r, 0, Math.PI*2); ctx.fill();
        });
        requestAnimationFrame(animateBg);
    }

</script>

</body></html>